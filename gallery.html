<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Галерея — Калды</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/main.css" />
  <link rel="icon" href="assets/logo.png" type="image/png">
</head>
<body>
  <div class="container">

<header class="header">
  <a class="brand" href="index.html">
    <img src="assets/logo.png" alt="Калды — логотип">
    <div class="title"><span class="ru">Калды</span><span class="subtitle">База отдыха</span></div>
  </a>

  <!-- КНОПКА-БУРГЕР -->
  <button class="burger" aria-label="Меню" aria-expanded="false">
    <span></span><span></span><span></span>
  </button>

  <nav class="nav">
    <a href="rooms.html">Домики</a>
    <a href="services.html">Услуги</a>
    <a href="gallery.html">Галерея</a>
    <a href="index.html#about">О нас</a>
    <a href="contacts.html">Контакты</a>
    <a class="btn" href="#" onclick="bookingStub(event)">Забронировать</a>
  </nav>
</header>

<section class="section">
  <h2>Фотогалерея</h2>
  <div class="gallery" id="galleryAuto" data-prefix="assets/gallery/photo-" data-start="1" data-max="500">
    <!-- статические примеры (дальше подгрузит initAutoGallery из main.js) -->
    <img src="assets/territory/terr-1.jpg" alt="Фото 1">
    <img src="assets/rooms/standard-1.jpg" alt="Фото 2">
    <img src="assets/rooms/cottage-1.jpg" alt="Фото 3">
    <img src="assets/rooms/forest-1.jpg" alt="Фото 4">
  </div>
</section>

<!-- ЕДИНЫЙ лайтбокс (как в деталке) -->
<div id="lightbox" class="lightbox" style="display:none;">
  <button class="lightbox-close" aria-label="Закрыть">×</button>
  <button class="lightbox-prev" aria-label="Предыдущее фото">‹</button>
  <img src="" alt="" class="lightbox-img">
  <button class="lightbox-next" aria-label="Следующее фото">›</button>
</div>

  </div>
<footer class="footer">
  <div class="container">
    <div class="row">
      <div>© 2025 «Калды». База отдыха у озера.</div>
      <div class="badge-pill">Тёплый отдых у воды</div>
    </div>
  </div>
</footer>

<script src="scripts/main.js"></script>
<script>
  // мини-подстраховка: работает даже без initMobileMenu()
  document.addEventListener('DOMContentLoaded', function(){
    var burger = document.querySelector('.burger');
    var mask   = document.querySelector('.nav-mask');
    var nav    = document.querySelector('.nav');
    if(!burger || !nav) return;

    function open(){ document.body.classList.add('nav-open');  burger.setAttribute('aria-expanded','true'); }
    function close(){ document.body.classList.remove('nav-open'); burger.setAttribute('aria-expanded','false'); }

    burger.addEventListener('click', function(){
      document.body.classList.contains('nav-open') ? close() : open();
    });
    mask && mask.addEventListener('click', close);
    nav.querySelectorAll('a').forEach(function(a){ a.addEventListener('click', close); });
    window.addEventListener('keydown', function(e){ if(e.key==='Escape') close(); });
    window.addEventListener('resize', function(){ if(window.innerWidth>900) close(); });
  });
</script>
<!-- Инициализация лайтбокса для галереи -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  initLightboxFor('.gallery img');
});

function initLightboxFor(selector){
  const images = Array.from(document.querySelectorAll(selector));
  if(!images.length) return;

  const lb   = document.getElementById('lightbox');
  const img  = lb.querySelector('.lightbox-img');
  const btnX = lb.querySelector('.lightbox-close');
  const prev = lb.querySelector('.lightbox-prev');
  const next = lb.querySelector('.lightbox-next');

  let index = 0;

  function closeMobileMenu(){
    if (document.body.classList.contains('nav-open')) {
      document.body.classList.remove('nav-open');
      const burger = document.querySelector('.burger');
      if (burger) burger.setAttribute('aria-expanded','false');
    }
  }

  function show(i){
    index = (i + images.length) % images.length;
    const el = images[index];
    img.src = el.getAttribute('data-full') || el.getAttribute('data-src') || el.src;
    closeMobileMenu();
    document.body.classList.add('modal-open');       // блокируем клики по шапке/меню в CSS
    lb.style.display = 'flex';
  }
  function hide(){
    lb.style.display = 'none';
    document.body.classList.remove('modal-open');
  }

  images.forEach((el, i) => el.addEventListener('click', ()=>show(i)));
  btnX .addEventListener('click', hide);
  prev.addEventListener('click', ()=> show(index - 1));
  next.addEventListener('click', ()=> show(index + 1));
  lb.addEventListener('click', e => { if (e.target === lb) hide(); });

  document.addEventListener('keydown', e => {
    if (lb.style.display === 'flex') {
      if (e.key === 'Escape') hide();
      if (e.key === 'ArrowLeft')  show(index - 1);
      if (e.key === 'ArrowRight') show(index + 1);
    }
  });

  /* === СВАЙП В МОДАЛКЕ (тач/указатель) === */
  let startX = 0, startY = 0, swiping = false, locked = null;
  const THRESH = 40; // пикселей

  function onStart(x, y){
    startX = x; startY = y;
    swiping = true; locked = null;
  }
  function onMove(x, y, e){
    if(!swiping) return;
    if (locked == null) {
      // Определяем направление — блокируем вертикальную прокрутку при горизонтальном свайпе
      locked = Math.abs(x - startX) > Math.abs(y - startY) ? 'x' : 'y';
    }
    if (locked === 'x') e.preventDefault();
  }
  function onEnd(x){
    if(!swiping) return;
    const dx = x - startX;
    if (Math.abs(dx) > THRESH) {
      dx < 0 ? show(index + 1) : show(index - 1);
    }
    swiping = false; locked = null;
  }

  // Touch
  lb.addEventListener('touchstart', e => onStart(e.touches[0].clientX, e.touches[0].clientY), {passive:true});
  lb.addEventListener('touchmove',  e => onMove(e.touches[0].clientX, e.touches[0].clientY, e), {passive:false});
  lb.addEventListener('touchend',   e => onEnd(e.changedTouches[0].clientX), {passive:true});

  // Pointer (мышь/стилус)
  lb.addEventListener('pointerdown', e => onStart(e.clientX, e.clientY));
  lb.addEventListener('pointermove',  e => onMove(e.clientX, e.clientY, e));
  lb.addEventListener('pointerup',    e => onEnd(e.clientX));
}
</script>

</body>
</html>
