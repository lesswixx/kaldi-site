<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Главная — Калды</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/main.css" />
  <link rel="icon" href="assets/logo.png" type="image/png">
</head>
<body>
  <div class="container">

<header class="header">
  <a class="brand" href="index.html">
    <img src="assets/logo.png" alt="Калды — логотип">
    <div class="title"><span class="ru">Калды</span><span class="subtitle">База отдыха</span></div>
  </a>

  <!-- КНОПКА-БУРГЕР -->
  <button class="burger" aria-label="Меню" aria-expanded="false">
    <span></span><span></span><span></span>
  </button>

  <nav class="nav">
    <a href="rooms.html">Домики</a>
    <a href="services.html">Услуги</a>
    <a href="gallery.html">Галерея</a>
    <a href="index.html#about">О нас</a>
    <a href="contacts.html">Контакты</a>
    <a class="btn" href="#" onclick="bookingStub(event)">Забронировать</a>
  </nav>
</header>

<!-- ПОДЛОЖКА ДЛЯ ЗАТЕМНЕНИЯ ФОНА -->
<div class="nav-mask"></div>


<section class="hero">
  <div class="hero-inner">
    <div class="hero-copy">
      <span class="badge"><span class="dot"></span> Лето у озера ждёт вас</span>
      <h1>Тёплый отдых у воды<br>с уютными домиками</h1>
      <p>Семейные выходные, корпоративы или романтические вечера — у нас есть домики на любой вкус, чистый пляж и активный досуг.</p>
      <div class="hero-actions">
        <a class="btn" href="#" onclick="bookingStub(event)">Проверить даты</a>
        <a class="brand" href="gallery.html" style="gap:8px;">
          <img src="assets/logo.png" alt="" style="width:36px;height:36px;border-radius:8px;">
          <span style="font-weight:700">3D-тур (скоро)</span>
        </a>
      </div>
    </div>

<aside class="hero-card" aria-label="Быстрое бронирование" style="position:relative;">

  <!-- Виджет погоды — ДОЛЖЕН быть внутри hero-card -->
  <div id="weather"
       class="weather"
       data-fallback-lat="55.66"
       data-fallback-lon="61.30">
    <div class="w-row">
      <strong id="wTemp">—°</strong>
      <div class="w-meta">
        <div id="wCond">Погода</div>
        <small id="wCity">Загрузка…</small>
      </div>
    </div>
  </div>

  <div class="row">
    <div><label>Заезд</label><div class="field">12.08.2025</div></div>
    <div><label>Выезд</label><div class="field">15.08.2025</div></div>
  </div>
  <div class="row">
    <div><label>Гости</label><div class="field">2 взрослых · 1 ребёнок</div></div>
    <div><label>Тип домика</label><div class="field">Стандарт у озера</div></div>
  </div>
  <a class="btn" href="#" onclick="bookingStub(event)">Забронировать</a>
  <a class="btn" href="contacts.html" style="background:#4CB7C5">Связаться с нами</a>
</aside>

  </div>
  <div class="wave" aria-hidden="true">
    <svg viewBox="0 0 1440 90" preserveAspectRatio="none">
      <path d="M0,40 C260,100 420,10 720,40 C1020,70 1180,10 1440,40 L1440,90 L0,90 Z" fill="#4CB7C5" opacity=".35"></path>
    </svg>
  </div>
</section>

<!-- О нас -->
<section id="about" class="section card">
  <h2>О нас</h2>
  <p>«Калды» — семейная база отдыха у озера. Мы любим тёплые вечера, запах хвои и чистую воду. Основаны в 2010 году, развиваем территорию и сервис каждый сезон.</p>
  <div class="about-photos">
    <img src="assets/territory/terr-1.jpg" alt="Территория — вид 1">
    <img src="assets/territory/terr-2.jpg" alt="Территория — вид 2">
    <img src="assets/territory/terr-3.jpg" alt="Территория — вид 3">
  </div>
</section>

<!-- Преимущества -->
<section class="section grid-3">
  <article class="card feature-card" data-modal-open="feat-water">
    <span class="badge-pill">У воды</span>
    <h3>Песчаный пляж и чистое озеро</h3>
    <p>Шезлонги, прокат сапов и безопасная зона для детей. Расслабьтесь под тёплым солнцем.</p>
  </article>
  <article class="card feature-card" data-modal-open="feat-houses">
    <span class="badge-pill">Домики</span>
    <h3>Уют и комфорт</h3>
    <p>От компактных домиков до просторных коттеджей — кондиционер, терраса, мангал.</p>
  </article>
  <article class="card feature-card" data-modal-open="feat-activities">
    <span class="badge-pill">Активности</span>
    <h3>Досуг на любой вкус</h3>
    <p>Баня, спортплощадки, аренда велосипедов и вечерние костры у воды.</p>
  </article>
</section>

<section class="section">
  <a class="btn" href="rooms.html">Смотреть домики и цены</a>
</section>

  </div>

<!-- Модалки преимуществ -->
<div class="modal" id="feat-water" aria-hidden="true">
  <div class="modal__dialog">
    <button class="modal__close" data-modal-close aria-label="Закрыть">×</button>
    <h3>Пляж и озеро</h3>
    <p>Чистая вода, пологий вход — отлично для детей.</p>
    <div class="modal__slider" data-slider>
      <div class="modal__slides">
        <div class="modal__slide"><img src="assets/territory/terr-1.jpg" alt=""></div>
        <div class="modal__slide"><img src="assets/territory/terr-2.jpg" alt=""></div>
        <div class="modal__slide"><img src="assets/territory/terr-3.jpg" alt=""></div>
      </div>
      <button class="modal__prev">‹</button>
      <button class="modal__next">›</button>
    </div>
  </div>
</div>

<div class="modal" id="feat-houses" aria-hidden="true">
  <div class="modal__dialog">
    <button class="modal__close" data-modal-close aria-label="Закрыть">×</button>
    <h3>Домики</h3>
    <p>От стандартных до семейных коттеджей — все с террасами и мангалом.</p>
    <div class="modal__slider" data-slider>
      <div class="modal__slides">
        <div class="modal__slide"><img src="assets/rooms/standard-1.jpg" alt=""></div>
        <div class="modal__slide"><img src="assets/rooms/cottage-1.jpg" alt=""></div>
        <div class="modal__slide"><img src="assets/rooms/forest-1.jpg" alt=""></div>
      </div>
      <button class="modal__prev">‹</button>
      <button class="modal__next">›</button>
    </div>
  </div>
</div>

<div class="modal" id="feat-activities" aria-hidden="true">
  <div class="modal__dialog">
    <button class="modal__close" data-modal-close aria-label="Закрыть">×</button>
    <h3>Активности</h3>
    <p>Баня, велосипеды, площадки и вечерние костры.</p>
    <div class="modal__slider" data-slider>
      <div class="modal__slides">
        <div class="modal__slide"><img src="assets/activities/act-1.jpg" alt=""></div>
        <div class="modal__slide"><img src="assets/activities/act-2.jpg" alt=""></div>
      </div>
      <button class="modal__prev">‹</button>
      <button class="modal__next">›</button>
    </div>
  </div>
</div>

<!-- Лайтбокс «как в деталке» -->
<div id="lightbox" class="lightbox" style="display:none;">
  <button class="lightbox-close" aria-label="Закрыть">×</button>
  <button class="lightbox-prev" aria-label="Предыдущее фото">‹</button>
  <img src="" alt="" class="lightbox-img">
  <button class="lightbox-next" aria-label="Следующее фото">›</button>
</div>

<footer class="footer">
  <div class="container">
    <div class="row">
      <div>© 2025 «Калды». База отдыха у озера.</div>
      <div class="badge-pill">Тёплый отдых у воды</div>
    </div>
  </div>
</footer>



<script>
  document.addEventListener('DOMContentLoaded', function(){
    var burger = document.querySelector('.burger');
    var mask   = document.querySelector('.nav-mask');
    var nav    = document.querySelector('.nav');
    if(!burger || !nav) return;

    function open(){ document.body.classList.add('nav-open');  burger.setAttribute('aria-expanded','true'); }
    function close(){ document.body.classList.remove('nav-open'); burger.setAttribute('aria-expanded','false'); }

    burger.addEventListener('click', function(){
      document.body.classList.contains('nav-open') ? close() : open();
    });
    mask && mask.addEventListener('click', close);
    nav.querySelectorAll('a').forEach(function(a){ a.addEventListener('click', close); });
    window.addEventListener('keydown', function(e){ if(e.key==='Escape') close(); });
    window.addEventListener('resize', function(){ if(window.innerWidth>900) close(); });
  });
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  function closeMobileMenu(){
    document.body.classList.remove('nav-open');
    const burger = document.querySelector('.burger');
    if (burger) burger.setAttribute('aria-expanded','false');
  }

  // ===== Открытие модалки по карточке (feat-*) =====
  document.querySelectorAll('.feature-card[data-modal-open]').forEach(card => {
    card.addEventListener('click', () => openModal(card.getAttribute('data-modal-open'), card));
  });

  function openModal(id, opener){
    const modal = document.getElementById(id);
    if(!modal) return;

    closeMobileMenu();
    document.body.classList.add('modal-open');

    modal.classList.add('show');
    modal.setAttribute('aria-hidden','false');

    initModalSlider(modal);

    (modal.querySelector('.modal__next') || modal.querySelector('.modal__close') || modal).focus();

    const close = ()=>{
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden','true');
      document.body.classList.remove('modal-open');
      modal.removeEventListener('click', onBackdrop);
      document.removeEventListener('keydown', onEsc);
      document.removeEventListener('keydown', onArrows);
    };
    const onBackdrop = e => { if(e.target === modal || e.target.hasAttribute('data-modal-close')) close(); };
    const onEsc = e => { if(e.key === 'Escape') close(); };
    const onArrows = e => { if(e.key === 'ArrowLeft') modalSliderStep(modal,-1); if(e.key==='ArrowRight') modalSliderStep(modal, +1); };

    modal.addEventListener('click', onBackdrop);
    document.addEventListener('keydown', onEsc);
    document.addEventListener('keydown', onArrows);
  }

  // ===== Лайтбокс для "О нас" — добавим тоже закрытие меню и свайп
  function initLightboxFor(selector){
    const images = Array.from(document.querySelectorAll(selector));
    if(!images.length) return;

    const lb      = document.getElementById('lightbox');
    const lbImg   = lb.querySelector('.lightbox-img');
    const btnX    = lb.querySelector('.lightbox-close');
    const btnPrev = lb.querySelector('.lightbox-prev');
    const btnNext = lb.querySelector('.lightbox-next');

    let i = 0;

    function show(n){
      i = (n + images.length) % images.length;
      lbImg.src = images[i].getAttribute('data-full') || images[i].src;
      closeMobileMenu();
      document.body.classList.add('modal-open');
      lb.style.display = 'flex';
    }
    function hide(){
      lb.style.display = 'none';
      document.body.classList.remove('modal-open');
    }

    images.forEach((img, idx)=> img.addEventListener('click', ()=> show(idx)));
    btnX  .addEventListener('click', hide);
    btnPrev.addEventListener('click', ()=> show(i-1));
    btnNext.addEventListener('click', ()=> show(i+1));
    lb.addEventListener('click', e=>{ if(e.target===lb) hide(); });

    document.addEventListener('keydown', e=>{
      if(lb.style.display==='flex'){
        if(e.key==='Escape') hide();
        if(e.key==='ArrowLeft')  show(i-1);
        if(e.key==='ArrowRight') show(i+1);
      }
    });

    // СВАЙП внутри лайтбокса
    let sx=0, sy=0, tracking=false, axis=null;
    const THRESH=40;
    function start(x,y){ sx=x; sy=y; tracking=true; axis=null; }
    function move(x,y,e){
      if(!tracking) return;
      if(axis==null) axis = Math.abs(x-sx) > Math.abs(y-sy) ? 'x' : 'y';
      if(axis==='x') e.preventDefault();
    }
    function end(x){
      if(!tracking) return;
      const dx=x-sx;
      if(Math.abs(dx)>THRESH) (dx<0 ? btnNext.click() : btnPrev.click());
      tracking=false; axis=null;
    }
    lb.addEventListener('touchstart', e=>start(e.touches[0].clientX,e.touches[0].clientY), {passive:true});
    lb.addEventListener('touchmove',  e=>move(e.touches[0].clientX,e.touches[0].clientY,e), {passive:false});
    lb.addEventListener('touchend',   e=>end(e.changedTouches[0].clientX), {passive:true});
    lb.addEventListener('pointerdown', e=>start(e.clientX,e.clientY));
    lb.addEventListener('pointermove', e=>move(e.clientX,e.clientY,e));
    lb.addEventListener('pointerup',   e=>end(e.clientX));
  }

  initLightboxFor('.about-photos img');

  function initModalSlider(modal){
    if(modal.__sliderInited) return;
    modal.__sliderInited = true;

    const slider = modal.querySelector('[data-slider]');
    if(!slider) return;

    const track  = slider.querySelector('.modal__slides');
    const slides = slider.querySelectorAll('.modal__slide');
    const prev   = slider.querySelector('.modal__prev');
    const next   = slider.querySelector('.modal__next');

    let i = 0;

    function go(n){
      i = (n + slides.length) % slides.length;
      track.style.transform = `translateX(-${i*100}%)`;
    }

    prev && prev.addEventListener('click', e => { e.stopPropagation(); go(i-1); });
    next && next.addEventListener('click', e => { e.stopPropagation(); go(i+1); });

    slider.addEventListener('click', e=>{
      if(e.target.closest('.modal__prev, .modal__next')) return;
      const r = slider.getBoundingClientRect();
      (e.clientX - r.left < r.width/2) ? go(i-1) : go(i+1);
    });

    let sx=0, sy=0, tracking=false, axis=null;
    const THRESH=40;

    function start(x,y){ sx=x; sy=y; tracking=true; axis=null; }
    function move(x,y,e){
      if(!tracking) return;
      if(axis==null) axis = Math.abs(x-sx) > Math.abs(y-sy) ? 'x' : 'y';
      if(axis==='x') e.preventDefault();
    }
    function end(x){
      if(!tracking) return;
      const dx=x-sx;
      if(Math.abs(dx)>THRESH) (dx<0 ? go(i+1) : go(i-1));
      tracking=false; axis=null;
    }

    slider.addEventListener('touchstart', e=>start(e.touches[0].clientX,e.touches[0].clientY), {passive:true});
    slider.addEventListener('touchmove',  e=>move(e.touches[0].clientX,e.touches[0].clientY,e), {passive:false});
    slider.addEventListener('touchend',   e=>end(e.changedTouches[0].clientX), {passive:true});

    slider.addEventListener('pointerdown', e=>start(e.clientX,e.clientY));
    slider.addEventListener('pointermove', e=>move(e.clientX,e.clientY,e));
    slider.addEventListener('pointerup',   e=>end(e.clientX));

    go(0);

    modal.__goSlide = n => go(i+n);
  }

  function modalSliderStep(modal, step){
    if(typeof modal.__goSlide === 'function') modal.__goSlide(step);
  }
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  const box    = document.getElementById('weather');
  if (!box) return;

  const tempEl = document.getElementById('wTemp');
  const condEl = document.getElementById('wCond');
  const cityEl = document.getElementById('wCity');

  const FALLBACK_LAT = Number(box.dataset.fallbackLat) || 55.66;
  const FALLBACK_LON = Number(box.dataset.fallbackLon) || 61.30;

  const codeName = code => ({
    0:'Ясно',1:'Преим. ясно',2:'Перем. облачно',3:'Пасмурно',
    45:'Туман',48:'Иней',51:'Морось',53:'Морось',55:'Морось',
    61:'Дождь',63:'Дождь',65:'Сильный дождь',
    71:'Снег',73:'Снег',75:'Сильный снег',
    80:'Ливни',81:'Ливни',82:'Сильные ливни',
    95:'Гроза',96:'Гроза',99:'Гроза'
  }[code] || 'Погода');

  function fetchWeather(lat, lon, label){
    if (label) cityEl.textContent = label;
    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`)
      .then(r => r.ok ? r.json() : Promise.reject(r))
      .then(d => {
        const cw = d.current_weather || {};
        const t  = Math.round(cw.temperature ?? NaN);
        tempEl.textContent = Number.isFinite(t) ? `${t}°` : '—°';
        condEl.textContent = codeName(cw.weathercode);
      })
      .catch(() => {
        tempEl.textContent = '—°';
        condEl.textContent = 'Погода';
      });
  }

  let geoDone = false;
  if (navigator.geolocation && (location.protocol === 'https:' || location.hostname === 'localhost')) {
    navigator.geolocation.getCurrentPosition(
      pos => { geoDone = true; fetchWeather(pos.coords.latitude, pos.coords.longitude, 'Ваше местоположение'); },
      () => fetchWeather(FALLBACK_LAT, FALLBACK_LON, 'База отдыха'),
      { timeout: 3000, maximumAge: 600000 }
    );
    setTimeout(()=>{ if (!geoDone) fetchWeather(FALLBACK_LAT, FALLBACK_LON, 'База отдыха'); }, 1500);
  } else {
    fetchWeather(FALLBACK_LAT, FALLBACK_LON, 'База отдыха');
  }
});
</script>

<script src="scripts/main.js"></script>

</body>
</html>
